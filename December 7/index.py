def StarThirteen(diagram):
    lines = diagram.strip().split('\n')
    
    # Find starting position (S)
    start_col = None
    for col, char in enumerate(lines[0]):
        if char == 'S':
            start_col = col
            break
    
    # Track active beams as a set to auto-merge beams at same position
    beams = {(0, start_col)}
    split_splitters = set()
    
    # Simulate beam movement row by row
    while beams:
        new_beams = set()
        
        for row, col in beams:
            # Move beam down one row
            row += 1
            
            # Check if beam exits the manifold
            if row >= len(lines):
                continue
            
            # Check what's at this position
            if lines[row][col] == '^':
                # Hit a splitter! Track it
                split_splitters.add((row, col))
                
                # Left beam
                if col > 0:
                    new_beams.add((row, col - 1))
                
                # Right beam
                if col < len(lines[row]) - 1:
                    new_beams.add((row, col + 1))
            else:
                # Empty space, beam continues downward
                new_beams.add((row, col))
        
        beams = new_beams
    
    return len(split_splitters)


def count_timelines(diagram):
    lines = diagram.strip().split('\n')
    
    # Find starting position (S)
    start_col = None
    for col, char in enumerate(lines[0]):
        if char == 'S':
            start_col = col
            break
    
    # Track particles: {col: count} for current row only
    particles = {start_col: 1}
    
    # Process row by row
    for row in range(len(lines) - 1):
        new_particles = {}
        
        for col, count in particles.items():
            next_row = row + 1
            
            # Check what's at the next position
            if lines[next_row][col] == '^':
                # Hit a splitter! Split into two timelines
                
                # Left path
                if col > 0:
                    new_particles[col - 1] = new_particles.get(col - 1, 0) + count
                
                # Right path
                if col < len(lines[next_row]) - 1:
                    new_particles[col + 1] = new_particles.get(col + 1, 0) + count
            else:
                # Empty space, particle continues
                new_particles[col] = new_particles.get(col, 0) + count
        
        particles = new_particles
    
    # Sum all timelines
    return sum(particles.values())


# Your diagram
diagram = """......................................................................S......................................................................
.............................................................................................................................................
......................................................................^......................................................................
.............................................................................................................................................
.....................................................................^.^.....................................................................
.............................................................................................................................................
....................................................................^.^.^....................................................................
.............................................................................................................................................
...................................................................^.^.^.^...................................................................
.............................................................................................................................................
..................................................................^.^.^.^.^..................................................................
.............................................................................................................................................
.................................................................^.^...^.^.^.................................................................
.............................................................................................................................................
................................................................^...^...^.^.^................................................................
.............................................................................................................................................
...............................................................^.^...^.^.^...^...............................................................
.............................................................................................................................................
..............................................................^.^.^.^.^.....^.^..............................................................
.............................................................................................................................................
.............................................................^.....^.^.^.^...^.^.............................................................
.............................................................................................................................................
............................................................^.^.^...^.^.^.^.^.^.^............................................................
.............................................................................................................................................
...........................................................^...^.^.^.^...^...^...^...........................................................
.............................................................................................................................................
..........................................................^.^.^.^.^.^.....^.^.^...^..........................................................
.............................................................................................................................................
.........................................................^...^.^.......^...^.......^.........................................................
.............................................................................................................................................
........................................................^.^...^.^.^.^.^.....^...^.^.^........................................................
.............................................................................................................................................
.......................................................^...^...^...^.^...^.^.^.^...^.^.......................................................
.............................................................................................................................................
......................................................^.^.^.^.^...^.^.^...^.^.^.^.^...^......................................................
.............................................................................................................................................
.....................................................^.^.^.^.....^...^.........^.^...^.^.....................................................
.............................................................................................................................................
....................................................^.^.^.^.^.^.^.^.^...^.^.^.....^...^.^....................................................
.............................................................................................................................................
...................................................^...^.^...^.^...^.^.^.^.^...^.^.^.^.^.^...................................................
.............................................................................................................................................
..................................................^.....^.^.^...^.^.....^.^...^.^.^.^.^.^.^..................................................
.............................................................................................................................................
.................................................^.^.^...^.....^...^...^.^.^.^.^.^.^.^.^...^.................................................
.............................................................................................................................................
................................................^.^...^...^.^...^.^.^...^.^.....^...^.....^.^................................................
.............................................................................................................................................
...............................................^.^.^...^.^.....^...^...^...^.^...^.^.^.......^...............................................
.............................................................................................................................................
..............................................^...^.^...^.......^.^.^.^.^.^.^.^.^...^...^.....^..............................................
.............................................................................................................................................
.............................................^...^.^.....^.......^.^.^.^.^.^...^.^.^.^.....^...^.............................................
.............................................................................................................................................
............................................^.^.^.........^.^.....^.^.^.^.^...^.^.^.^.^...^.....^............................................
.............................................................................................................................................
...........................................^.^.^.^...^.....^.^.^.^.^...^...^.^.....^...^...^.^.^.^...........................................
.............................................................................................................................................
..........................................^.....^.^.^.^.^.^...^.....^.^.....^...^...^.^.^.^.^...^.^..........................................
.............................................................................................................................................
.........................................^.^...^.^.....^.^...^.^.^.^.^.^.^.^.^.^...^.....^.....^.^.^.........................................
.............................................................................................................................................
........................................^.....^.^.^.^.^.^.^...^...^.^.^.^.......^.^.^.^.^.^.^.^.^.^.^........................................
.............................................................................................................................................
.......................................^.^.^.^.^.^.^.^...^.^...^.^.^.^...^...^.....^.^.^...^.^...^.^.^.......................................
.............................................................................................................................................
......................................^.......^.^.........^...^.............^.^.^.^...^.^.^.^.^.^.^.^.^......................................
.............................................................................................................................................
.....................................^.^.^...^.^.^.^.....^.^.^...^.^.^.^.....^.^.^.^...^.......^.^...^.^.....................................
.............................................................................................................................................
....................................^...^.^...^.^.^...^.....^...^.......^.^.......^...^...^.^.^.^...^...^....................................
.............................................................................................................................................
...................................^.^.^.^.^.......^.^...^.^...^.^...^.^...^...^.^.^...^.^.^.^.^.^.^.^.^.^...................................
.............................................................................................................................................
..................................^.........^.^.^.^.^...^.^.^...^.^.^...^.^.^.^...^...^.^.^.....^...^.^.^.^..................................
.............................................................................................................................................
.................................^.^.^...^...^.^.....^.^.^.^...^.^.^.^.^.^.^...^...^.^.^...^.^.^.^...^.^.^.^.................................
.............................................................................................................................................
................................^.^.....^...^.....^...^.^...^.^.^.^...^...^.^.^.^.^.^...^.^.^.^.^.^.^...^.^.^................................
.............................................................................................................................................
...............................^...^.^...^.^.^...^...^.^.^.^.^.^...^.^.^.^...^.^.^.^.^...^...^...^.^.^.....^.^...............................
.............................................................................................................................................
..............................^.^.....^.^.^.^.....^.^.^.....^.^.^.^.^.^.......^...^.^.^.^.^...^.^.^.^.^.^.^.^.^..............................
.............................................................................................................................................
.............................^.^.....^...^.^.^.......^.^...^.^.^...^...^.^...^...^.^...^.^.^.^.^.^.^.^...^.^...^.............................
.............................................................................................................................................
............................^.....^.^...^.^.^.......^.^.^.^.......^.^.^.^.^.^.^...^.^.^.^...^...^.......^.^.^.^.^............................
.............................................................................................................................................
...........................^.^.^...^...^.^.^.^...^.^.^.^.^.....^...^...^.....^...^.^.^.^.^.........^.^.....^.^.^.^...........................
.............................................................................................................................................
..........................^.^...^.^...^.^.^.^.......^.^.^.^.^...^.^.....^.^.^.....^.....^...^.......^.^.^.^.^.....^..........................
.............................................................................................................................................
.........................^.^.^.^.....^.^...^.^.^.^.^.^.^.^...^.^.^.....^.^.^...^.^...^.^...^...^...^...^.^.^.^...^.^.........................
.............................................................................................................................................
........................^.^.^...^.^.^.^...^.....^...^.^.^.^.^.^...^.....^.^.^.^.^.^...^...^.^...........^...^...^...^........................
.............................................................................................................................................
.......................^.^...^.^.^.^.^.^.^.^.^.^.^.^.^.^...^.......^.^.^.^.^.^...^...^...^.^.^.^.^.......^.^.^.^.^.^.^.......................
.............................................................................................................................................
......................^.......^.^.^.^...^.^...^.^...^.^...^.^.^.^.^...^.^.^...^...^.^...^...^.^.^.^.^.^.^.^.^.....^.^.^......................
.............................................................................................................................................
.....................^...^.....^.^.....^.^.^.^...^.^.^.....^.....^.^.^...^...^.^.^.....^.^.^.^.^.^.^.^.^.^.^.^.^.^.^...^.....................
.............................................................................................................................................
....................^...^...^.^.^.^...^.^...^.^.^.^...^...^.^.^.^...^.^.^.^.^...^.^.......^.^.^.^...^...^.....^.^.....^.^....................
.............................................................................................................................................
...................^...^.^.^.^...^...^.^.....^...^.^.^.^.^.^.^.^.^.^.....^.^...^.....^...^.^...^.^...^.^.^.^.^...^.^...^.^...................
.............................................................................................................................................
..................^.^.....^...^.^.^.^.^.^.^.^...^.^.^.^.^.^.^.^.^.^.^.^.^.^.^.^.....^.^.^.^.^.....^.^.^.^...^.^...^.^.^.^.^..................
.............................................................................................................................................
.................^.^...^.^.^.^.^.^.^.^.^...^.^.....^.....^.^.^.^...^.^.^.^...^...^...^.^.^.^.^.^.^.......^.....^.^.....^...^.................
.............................................................................................................................................
................^.^.^.........^...^.^...^.^.^.^.^.^...^...^...^.^.^...^.^.......^.^.^...^...^.^.^.^.^.^...^...^.....^.^.....^................
.............................................................................................................................................
...............^.^.......^.^.^.^...^.^.^...^.^...^.^.^.^...^.....^.^.....^.^.^.....^.^.^.^.^.^.^.^.^.^.^.^...^.^...^.^.....^.^...............
.............................................................................................................................................
..............^.^.^.^...^.....^.^.^.^.^.^...^...^.^.^.^...^.^.....^.^...^.....^.^...^...^...^.^.^...^.^.....^...^.^.^.^.^.^.^.^..............
.............................................................................................................................................
.............^.^.^.^.^.^.^.^.^.....^...^...^...^.......^.^.^...^...^...^.^...^...^.....^.^.......^.^.....^...^...^.....^.^.^.^.^.............
.............................................................................................................................................
............^.^.......^.....^.^.^.^.^.^.^.^.^.^.....^.^.^...^.^.^.^.^.^...^.......^.^.^...^...^...^...........^.^.^.^...^...^.^.^............
.............................................................................................................................................
...........^...^.^.....^.^.^.^.^.^...^.....^...^...^.^.^.^.^.^...^.^.^.^.^.^.^...^.....^.^.^.....^...^.^.^.^.....^.^.^.^.......^.^...........
.............................................................................................................................................
..........^.^...^...^.^.^.^.^.^.....^.........^...^.^.^.^.^.^...^.^.^.........^.^.^.^.^...^...^.^.^.^.^...^.^.^.^...^.^.^.^.^...^.^..........
.............................................................................................................................................
.........^.^.^...^.......^.^.^.^.^.....^...^.^...^...^.^...^...^...^.^.^.^.^.^.^.^.^.^.^.....^...^.^.^.....^...^.^.^.^.....^...^.^.^.........
.............................................................................................................................................
........^.^...^.^.^.^...^...^.....^...^.^.^.....^.^...^.^.^.^.^...^.....^...^.^...^.^.....^.....^.^.^.^...^.^.....^.^.^.....^.^.^.^.^........
.............................................................................................................................................
.......^.^.^.^.....^.........^...^.........^.^.....^.^.^.^.^.^.....^.^.^...^.^...^.^.^.^.^.^.....^.^.^.^.^.^...^.......^.^...^.^.^.^.^.......
.............................................................................................................................................
......^.^.^.....^.^.^.^.^.^...^.^.....^.^.^.^.^...^...^.^.........^.^...^.^.^.^.^.^.^.^.......^.^.^.^.....^...^...^...^...^.^.....^...^......
.............................................................................................................................................
.....^.^.....^.^.^.^.^.^.^.^.....^.^...^.^.^...^.....^...^.^.^.^.^.^...^.............^.^.^...^.^.....^.^.....^.^.....^.^.^.^.^.^.....^.^.....
.............................................................................................................................................
....^.^.^.^.^...^.^...^.......^.^.^.^.^...^.^.^...^.^.^.^.^.^.^.^...^.^.^.^.^...^.^.^.^.^.^...^...^.....^.^.^...^.^...^.^.^...^.^...^.^.^....
.............................................................................................................................................
...^.^.^.^.^.^.....^...^...^.^...^...^.^...^.^...^.^.^.^.......^...^.^.^...^...^.^.^...^.^.^.^...^...^.^.^...^.^.^.^.^.^.^.^.^...^...^.^.^...
.............................................................................................................................................
..^.^.^...^.^.........^.^...^.^.^.^.^.......^.^.....^...^.....^...^...^...^.....^.^.^.....^...^.....^.......^.^.^...^.^.....^.^.....^.^.^.^..
.............................................................................................................................................
.^.^.^.^.^...^...^...^.^...^.^...^.^.^.^.....^.^.^.^.....^.^...^.^.^.^.^.^.^...........^.^.^.^.......^.^.^.^.^...^.^.^.^.^.^.^.^.....^.^...^.
............................................................................................................................................."""

result = count_timelines(diagram)
print(f"Number of timelines: {result}")